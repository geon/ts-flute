var Z=Object.defineProperty;var b=(a,o,c)=>o in a?Z(a,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[o]=c;var i=(a,o,c)=>b(a,typeof o!="symbol"?o+"":o,c);(function(){"use strict";function a(n,e){class s extends AudioWorkletProcessor{constructor({processorOptions:h}){super();i(this,"toneOscilator");i(this,"midiMessages",[]);this.toneOscilator=e(h.sampleRate),this.toneOscilator.next(),this.port.onmessage=l=>{this.midiMessages.push(l.data)}}process(h,l,I){var f;const p=(f=l[0])==null?void 0:f[0];if(!p)throw new Error("Missing channel.");for(let u=0;u<p.length;u++)p[u]=this.toneOscilator.next(this.midiMessages.shift()).value;return!0}}registerProcessor(n,s)}class o{constructor(e){i(this,"sinZ",0);i(this,"cosZ",0);this.frequency=e}step(e,s){const r=2*Math.PI*(this.frequency/sampleRate);this.sinZ=this.sinZ+this.cosZ*r,this.cosZ=this.cosZ-this.sinZ*r;const t=1e-4*(-1+2*Math.random());return this.sinZ=c(this.sinZ+t+s*r,e),this.sinZ}}function c(n,e){return Math.max(-e,Math.min(e,n))}class g{constructor(e,s){i(this,"samplesLeftToTarget");i(this,"current");i(this,"target");this.samplerate=e,this.samplesLeftToTarget=0,this.current=s,this.target=s}setTarget(e,s){this.target=e,this.samplesLeftToTarget=this.samplerate*s}step(){return this.samplesLeftToTarget&&(this.current+=(this.target-this.current)/this.samplesLeftToTarget,--this.samplesLeftToTarget),this.current}}function w(n){return 440*Math.pow(2,(n-69)/12)}class m{constructor(e){i(this,"cursor");i(this,"samples");if(!e)throw new Error("A delay line must have a size.");this.cursor=0,this.samples=[];for(let s=0;s<e;++s)this.samples[s]=0}read(){return this.samples[this.cursor]}write(e){this.samples[this.cursor]=e}step(){this.cursor=(this.cursor+1)%this.samples.length}}class T{constructor(e){i(this,"delayLines");this.delayLines=[new m(e),new m(e)]}read(){return[this.delayLines[0].read(),this.delayLines[1].read()]}write(e){this.delayLines[0].write(e[0]),this.delayLines[1].write(e[1])}step(){this.delayLines[0].step(),this.delayLines[1].step()}}const y="pan-flute";class L{constructor(e,s){i(this,"pipe");i(this,"whistle");i(this,"volumeInterpolator");const r=e/d,t=d/s;this.pipe=new T(t*r),this.whistle=new o(220),this.volumeInterpolator=new g(e,0)}setVolumeTarget(e,s){this.volumeInterpolator.setTarget(e,s)}step(){const[s,r]=this.pipe.read(),t=this.whistle.step(this.volumeInterpolator.step(),r);return this.pipe.write([t+r*.75,s*-.75]),this.pipe.step(),s}}const d=343;function*M(n){const e=new Map;for(;;){const r=yield[...e.values()].map(t=>t.step()).reduce((t,h)=>t+h,0)*.2;if(r){let t=e.get(r.number);if(!t){const h=w(r.number);t=new L(n,h),e.set(r.number,t)}switch(r.type){case"noteon":{t.setVolumeTarget(.7,.06);break}case"noteoff":{t.setVolumeTarget(0,.02);break}}}}}function P(){a(y,M)}P()})();
